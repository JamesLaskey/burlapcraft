package com.kcaluru.burlapbot.actions;

import burlap.oomdp.core.Domain;
import burlap.oomdp.core.State;
import burlap.oomdp.singleagent.SADomain;

public class MovementAction extends AgentAction {
	
	protected int[][] movementMap;

	public MovementAction(String name, Domain domain, int[][][] map) {
		super(name, domain, map);
		movementMap = getMovementMap();
	}

	@Override
	void doAction(State state) {
		
		ObjectInstance agent = s.getFirstObjectOfClass(NameSpace.CLASSAGENT);
		int curX = agent.getDiscValForAttribute(NameSpace.ATX);
		int curZ = agent.getDiscValForAttribute(NameSpace.ATZ);
		
		//sample directon with random roll
		double r = Math.random();
		double sumProb = 0.;
		int dir = 0;
		for(int i = 0; i < this.directionProbs.length; i++){
			sumProb += this.directionProbs[i];
			if(r < sumProb){
				dir = i;
				break; //found direction
			}
		}
		
		//get resulting position
		int [] newPos = this.moveResult(curX, curZ, dir);
		
		//set the new position
		agent.setValue(NameSpace.ATX, newPos[0]);
		agent.setValue(NameSpace.ATY, 1);
		agent.setValue(NameSpace.ATZ, newPos[1]);
		
		//return the state we just modified
		return s;
	}

}
